app:
  data_dir: "./data"
  output_dir: "./output"
  log_level: "INFO"

ingest:
  encoding: "utf-8"
  chapter_regex: "^第[0-9一二三四五六七八九十百千]+章.*$"
  cleanup:
    strip_blank_lines: true
    normalize_fullwidth: true

split:
  chunk_size_tokens: 1200
  chunk_overlap_tokens: 120
  min_chunk_tokens: 200

llm:
  providers:
    deepseek:
      kind: "openai_compatible"
      base_url: "https://api.deepseek.com/v1"
      api_key_env: "DEEPSEEK_API_KEY"
    local_embedding:
      kind: "ollama"
      base_url: "http://localhost:11434"
      api_key_env: null

  chat_endpoints:
    summarize_default:
      provider: "deepseek"
      model: "deepseek-v3.2"
      temperature: 0.1
      timeout_s: 60
      max_concurrency: 6
      retries: 3
    storyteller_default:
      provider: "deepseek"
      model: "deepseek-v3.2"
      temperature: 0.45
      timeout_s: 60
      max_concurrency: 4
      retries: 3

  embedding_endpoints:
    embedding_default:
      provider: "local_embedding"
      model: "qwen3-embedding:4b"
      timeout_s: 60
      max_concurrency: 6
      retries: 3

  routes:
    summarize_chat: "summarize_default"
    storyteller_chat: "storyteller_default"
    storyteller_entity_chat: "storyteller_default"
    storyteller_narration_chat: "storyteller_default"
    storyteller_refine_chat: "storyteller_default"
    embedding: "embedding_default"

summarize:
  language: "zh"
  style: "清晰、克制、不剧透关键反转（可配置）"
  chapter_summary_words: [200, 500]
  book_summary_words: [800, 1500]
  include_quotes: false
  with_citations:
    enabled: true
    top_k: 6

storyteller:
  language: "zh"
  style: "说书人/评书艺人风格，沉浸感强，保留关键对白和心理博弈"
  narration_ratio: [0.4, 0.5]
  narration_temperature: 0.45
  entity_temperature: 0.1
  state_temperature: 0.1
  memory_top_k: 8
  recent_events_window: 5
  include_key_dialogue: true
  include_inner_thoughts: true
  refine_enabled: true
  refine_temperature: 0.35
  evidence_min_support_score: 0.18
  evidence_max_snippets: 3

storage:
  sqlite_path: "./data/novel.db"
  lancedb_dir: "./data/lancedb"

cache:
  enabled: true
  backend: "sqlite"
  ttl_seconds: 2592000
